var L=Object.defineProperty,j=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var w=(t,n,s)=>n in t?L(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,d=(t,n)=>{for(var s in n||(n={}))C.call(n,s)&&w(t,s,n[s]);if(v)for(var s of v(n))F.call(n,s)&&w(t,s,n[s]);return t},b=(t,n)=>j(t,D(n));var y=(t,n)=>{var s={};for(var a in t)C.call(t,a)&&n.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&v)for(var a of v(t))n.indexOf(a)<0&&F.call(t,a)&&(s[a]=t[a]);return s};import{R as e,b as _,A,r as u,a as U}from"./vendor.3ef63d80.js";const R=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}};R();const M="_element_l2ap8_1";var P={element:M};function N(a){var r=a,{className:t,children:n}=r,s=y(r,["className","children"]);const l=[...t||[],P.element].join(" ");return e.createElement("button",d({className:l},s),n)}const B="_element_13hkc_1";var K={element:B};function x(r){var l=r,{className:t,onEnter:n,onKeyDown:s}=l,a=y(l,["className","onEnter","onKeyDown"]);const o=[...t||[],K.element].join(" ");function c(i){if(i.code==="Enter"&&!(i.shiftKey||i.ctrlKey||i.altKey)){n&&n();return}s&&s(i)}return e.createElement("input",d({className:o,onKeyDown:c},a))}const G=["https://gdb.jgq.repl.co/gun"],p=_({peers:G}),S=A.default(p);function q(){const t=p.user().recall({sessionStorage:!0}),[n,s]=u.exports.useState(void 0),[a,r]=u.exports.useState({loading:!1});async function l(i,E){r({loading:!0});let f=0;for(;f<3;)try{await S.login({alias:i,pass:E}),r({loading:!1});break}catch(I){f+=1,f===3&&r({loading:!1,error:I.message})}}function o(i,E){r({loading:!0}),S.create({alias:i,pass:E}).then(()=>{r({loading:!1}),l(i,E)}).catch(f=>{r({loading:!1,error:f.message})})}function c(){S.logout(),s(void 0)}return u.exports.useEffect(()=>(p.on("auth",async()=>{const i=await t.get("alias");s(i)}),()=>p.off()),[]),{db:p,user:t,username:n,state:a,signUp:o,signIn:l,signOut:c}}const O=u.exports.createContext({});function T({children:t}){const n=q();return e.createElement(O.Provider,{value:n},t)}function g(){return u.exports.useContext(O)}const z="_container_1hvbs_1";var H={container:z};const V="d707731b-fa75-49de-91b6-fbb203eab4f9";function Y(){const{db:t,user:n}=g(),[s,a]=u.exports.useState("");async function r(){const l=await _.SEA.encrypt(s,V),o=n.get("all").set({content:l}),c=Date.now().toString();t.get("general").get(c).put(o),a("")}return e.createElement("div",{className:H.container},e.createElement(x,{type:"text",placeholder:"Type your message here...",onChange:l=>a(l.target.value),value:s,onEnter:r,maxLength:140}),e.createElement(N,{onClick:r,disabled:s.length===0},"Send"))}function J(){const[t,n]=u.exports.useState({});function s(a,r){const l=b(d({},t),{[a]:r});n(l)}return[t,s]}const Q="_container_f1467_1",W="_title_f1467_1",X="_form_f1467_8",Z="_inputField_f1467_12",ee="_errorField_f1467_19",te="_buttonField_f1467_24";var m={container:Q,title:W,form:X,inputField:Z,errorField:ee,buttonField:te};function ne(){const[{alias:t,pass:n},s]=J(),{state:{loading:a,error:r},signIn:l,signUp:o}=g();return e.createElement("div",{className:m.container},e.createElement("div",{className:m.title},e.createElement("h1",null,"Devjam Chat")),e.createElement("div",{className:m.form},e.createElement("div",{className:m.inputField},e.createElement("p",null,"Username:"),e.createElement(x,{type:"text",placeholder:"Example: Devjam",onChange:c=>s("alias",c.target.value),maxLength:15})),e.createElement("div",{className:m.inputField},e.createElement("p",null,"Password:"),e.createElement(x,{type:"password",placeholder:"Example: Devjam-App",onChange:c=>s("pass",c.target.value)})),e.createElement("div",{className:m.buttonField},e.createElement(N,{onClick:()=>l(t,n),disabled:a},"Sign In"),e.createElement(N,{onClick:()=>o(t,n),disabled:a},"Sign Up")),r&&e.createElement("div",{className:m.errorField},e.createElement("p",null,"Error: ",r))))}const re="_container_14gz9_1";var se={container:re};const ae="_container_nplcm_1",le="_username_nplcm_18";var $={container:ae,username:le};function oe(){const{username:t,signOut:n}=g();return e.createElement("div",{className:$.container},e.createElement("button",null,e.createElement("p",null,"Channel:"),e.createElement("h3",null,"#general")),e.createElement("div",{className:$.username},e.createElement("h1",null,t)),e.createElement("button",{onClick:n},e.createElement("p",null,"Sign Out")))}function ce(t){const n=u.exports.useRef(null),[s,a]=u.exports.useState(!1);return u.exports.useEffect(()=>{const r=n.current,l=new IntersectionObserver(([o])=>{a(o.isIntersecting)},t);return r&&l.observe(r),()=>{r&&l.unobserve(r)}},[]),[s,n]}const ie="_sender_1b54j_1",ue="_hidden_1b54j_21";var k={sender:ie,hidden:ue};function me(){const[t,n]=ce({root:null,threshold:1}),s=[k.sender,t?k.hidden:""].join(" ");function a(){const r=n.current;r&&r.scrollIntoView({behavior:"smooth"})}return e.createElement(e.Fragment,null,e.createElement("div",{className:s},e.createElement("button",{onClick:a},"\u2B07")),e.createElement("div",{ref:n}))}const de="_container_st4tg_1",fe="_message_st4tg_7",pe="_identifier_st4tg_11",ge="_error_st4tg_21";var h={container:de,message:fe,identifier:pe,error:ge};function Ee({alias:t,content:n,time:s,isUser:a}){const r=new Date(s).toLocaleString();return e.createElement("div",{className:h.message},e.createElement("div",{className:h.identifier},e.createElement("h3",null,t),e.createElement("h6",null,"\u2800",r),a&&e.createElement("h6",null,"\u2800(You)")),e.createElement("div",null,e.createElement("p",null,n)))}const ve="d707731b-fa75-49de-91b6-fbb203eab4f9";function _e(){const{db:t,username:n}=g(),[s,a]=u.exports.useState([]),[r,l]=u.exports.useState(!1);return u.exports.useEffect(()=>(t.get("general").map().once(async o=>{if(o){const c={alias:await t.user(o).get("alias"),content:await _.SEA.decrypt(o.content,ve),time:+_.state.is(o,"content")};c.alias||l(!0),c.content&&a(i=>[...i.slice(-100),c])}}),()=>t.get("general").map().off()),[]),e.createElement(e.Fragment,null,e.createElement("div",{className:h.container},s.sort((o,c)=>o.time-c.time).map((o,c)=>{const i=o.alias===n;return e.createElement(Ee,d({},b(d({},o),{isUser:i,key:c})))}),e.createElement(me,null)),r&&e.createElement("div",{className:h.error},e.createElement("p",null,"Some names weren't loaded properly, try refreshing the page."),e.createElement("button",{onClick:()=>l(!1)},"\u2716")))}function he(){const{username:t}=g();return e.createElement("div",{className:se.container},t?e.createElement(e.Fragment,null,e.createElement(oe,null),e.createElement(_e,null),e.createElement(Y,null)):e.createElement(ne,null))}function be(){return e.createElement(T,null,e.createElement(he,null))}U.render(e.createElement(e.StrictMode,null,e.createElement(be,null)),document.getElementById("root"));
