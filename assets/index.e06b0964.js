var k=Object.defineProperty,D=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var F=(n,r,s)=>r in n?k(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,d=(n,r)=>{for(var s in r||(r={}))S.call(r,s)&&F(n,s,r[s]);if(v)for(var s of v(r))w.call(r,s)&&F(n,s,r[s]);return n},b=(n,r)=>D(n,U(r));var h=(n,r)=>{var s={};for(var l in n)S.call(n,l)&&r.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&v)for(var l of v(n))r.indexOf(l)<0&&w.call(n,l)&&(s[l]=n[l]);return s};import{R as e,b as _,A,r as c,a as L}from"./vendor.3ef63d80.js";const R=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}};R();const M="_element_l2ap8_1";var B={element:M};function y(l){var t=l,{className:n,children:r}=t,s=h(t,["className","children"]);const a=[...n||[],B.element].join(" ");return e.createElement("button",d({className:a},s),r)}const K="_element_13hkc_1";var P={element:K};function x(t){var a=t,{className:n,onEnter:r,onKeyDown:s}=a,l=h(a,["className","onEnter","onKeyDown"]);const o=[...n||[],P.element].join(" ");function u(i){if(i.code==="Enter"&&!(i.shiftKey||i.ctrlKey||i.altKey)){r&&r();return}s&&s(i)}return e.createElement("input",d({className:o,onKeyDown:u},l))}const q=["https://gdb.jgq.repl.co/gun"],N=_({peers:q}),G=N.user().recall({sessionStorage:!0}),f=A.default(N),O=c.exports.createContext({});function E(){return c.exports.useContext(O)}function T({children:n}){const[r,s]=c.exports.useState(void 0),[l,t]=c.exports.useState({loading:!1});function a(i,p){t({loading:!0}),f.create({alias:i,pass:p}).then(()=>{t({loading:!1})}).catch(g=>{t({loading:!1,error:g.message})})}async function o(i,p){t({loading:!0});let g=0;for(;g<3;)try{await f.login({alias:i,pass:p}),t({loading:!1});break}catch(j){g+=1,g===3&&t({loading:!1,error:j.message})}}function u(){f.logout(),s(void 0)}return c.exports.useEffect(()=>(f.on(()=>{f.user().get("alias").once(p=>s(p))}),()=>{f.off()}),[]),e.createElement(O.Provider,{value:{db:N,user:G,username:r,state:l,signUp:a,signIn:o,signOut:u}},n)}const z="_container_1hvbs_1";var H={container:z};const V="d707731b-fa75-49de-91b6-fbb203eab4f9";function Y(){const{db:n,user:r}=E(),[s,l]=c.exports.useState("");async function t(){const a=await _.SEA.encrypt(s,V),o=r.get("all").set({content:a}),u=Date.now().toString();n.get("general").get(u).put(o),l("")}return e.createElement("div",{className:H.container},e.createElement(x,{type:"text",placeholder:"Type your message here...",onChange:a=>l(a.target.value),value:s,onEnter:t}),e.createElement(y,{onClick:t,disabled:s.length===0},"Send"))}function J(){const[n,r]=c.exports.useState({});function s(l,t){const a=b(d({},n),{[l]:t});r(a)}return[n,s]}const Q="_container_f1467_1",W="_title_f1467_1",X="_form_f1467_8",Z="_inputField_f1467_12",ee="_errorField_f1467_19",te="_buttonField_f1467_24";var m={container:Q,title:W,form:X,inputField:Z,errorField:ee,buttonField:te};function ne(){const[{alias:n,pass:r},s]=J(),{state:{loading:l,error:t},signIn:a,signUp:o}=E();return e.createElement("div",{className:m.container},e.createElement("div",{className:m.title},e.createElement("h1",null,"Devjam Chat")),e.createElement("div",{className:m.form},e.createElement("div",{className:m.inputField},e.createElement("p",null,"Username:"),e.createElement(x,{type:"text",placeholder:"Example: Devjam",onChange:u=>s("alias",u.target.value)})),e.createElement("div",{className:m.inputField},e.createElement("p",null,"Password:"),e.createElement(x,{type:"password",placeholder:"Example: Devjam-App",onChange:u=>s("pass",u.target.value)})),e.createElement("div",{className:m.buttonField},e.createElement(y,{onClick:()=>a(n,r),disabled:l},"Sign In"),e.createElement(y,{onClick:()=>o(n,r),disabled:l},"Sign Up")),t&&e.createElement("div",{className:m.errorField},e.createElement("p",null,"Error: ",t))))}const re="_container_14gz9_1";var se={container:re};const ae="_container_nplcm_1",le="_username_nplcm_18";var $={container:ae,username:le};function oe(){const{username:n,signOut:r}=E();return e.createElement("div",{className:$.container},e.createElement("button",null,e.createElement("p",null,"Channel:"),e.createElement("h3",null,"#general")),e.createElement("div",{className:$.username},e.createElement("h1",null,n)),e.createElement("button",{onClick:r},e.createElement("p",null,"Sign Out")))}function ce(n){const r=c.exports.useRef(null),[s,l]=c.exports.useState(!1);return c.exports.useEffect(()=>{const t=r.current,a=new IntersectionObserver(([o])=>{l(o.isIntersecting)},n);return t&&a.observe(t),()=>{t&&a.unobserve(t)}},[]),[s,r]}const ie="_sender_1b54j_1",ue="_hidden_1b54j_21";var I={sender:ie,hidden:ue};function me(){const[n,r]=ce({root:null,threshold:1}),s=[I.sender,n?I.hidden:""].join(" ");function l(){const t=r.current;t&&t.scrollIntoView({behavior:"smooth"})}return e.createElement(e.Fragment,null,e.createElement("div",{className:s},e.createElement("button",{onClick:l},"\u2B07")),e.createElement("div",{ref:r}))}const de="_container_dsosi_1",fe="_message_dsosi_7",pe="_identifier_dsosi_11";var C={container:de,message:fe,identifier:pe};function ge({alias:n,content:r,time:s,isUser:l}){const t=new Date(s).toLocaleString();return e.createElement("div",{className:C.message},e.createElement("div",{className:C.identifier},e.createElement("h3",null,n),e.createElement("h6",null,"\u2800",t),l&&e.createElement("h6",null,"\u2800(You)")),e.createElement("div",null,e.createElement("p",null,r)))}const Ee="d707731b-fa75-49de-91b6-fbb203eab4f9";function ve(){const{db:n,username:r}=E(),[s,l]=c.exports.useState([]);return c.exports.useEffect(()=>(n.get("general").map().once(async t=>{if(t){const a={alias:await n.user(t).get("alias"),content:await _.SEA.decrypt(t.content,Ee),time:+_.state.is(t,"content")};a.content&&l(o=>[...o.slice(-100),a])}}),()=>n.off()),[]),e.createElement("div",{className:C.container},s.sort((t,a)=>t.time-a.time).map((t,a)=>{const o=t.alias===r;return e.createElement(ge,d({},b(d({},t),{isUser:o,key:a})))}),e.createElement(me,null))}function _e(){const{username:n}=E();return e.createElement("div",{className:se.container},n?e.createElement(e.Fragment,null,e.createElement(oe,null),e.createElement(ve,null),e.createElement(Y,null)):e.createElement(ne,null))}function be(){return e.createElement(T,null,e.createElement(_e,null))}L.render(e.createElement(e.StrictMode,null,e.createElement(be,null)),document.getElementById("root"));
